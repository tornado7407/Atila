
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Sorteo con Ganadores</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
    }
    .controls, .exportControls {
      margin-bottom: 15px;
    }
    input[type="text"], input[type="number"], select {
      padding: 5px;
      margin: 5px;
      width: 150px;
    }
    #captureWrapper {
      display: inline-flex;
      align-items: flex-start;
      justify-content: center;
      padding: 15px;
      border: 3px solid #aaa;
      background-color: #fff;
      gap: 30px;
      margin-top: 20px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 10px;
    }
    .number {
      padding: 10px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
      font-weight: bold;
      white-space: pre-line;
      color: #000;
      width: 65px;
      height: 65px;
    }
    .premios {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .premios input {
      padding: 5px;
      width: 180px;
      box-sizing: border-box;
    }
    .premios-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    #fondoInput {
      display: none;
    }
    .custom-file-button {
      display: inline-block;
      padding: 6px 12px;
      background-color: #ddd;
      border: 1px solid #aaa;
      border-radius: 4px;
      cursor: pointer;
    }
    option[value="Efectivo"] { background-color: red; color: white; }
    option[value="Mercado Pago"] { background-color: yellow; color: black; }
    option[value="Banco Patagonia"] { background-color: lightblue; color: black; }
    option[value="Mercado Pago M√≠o"] { background-color: lightgreen; color: black; }
    option[value="No Pag√≥"] { background-color: #f9f9f9; color: black; }
  </style>
</head>
<body>
<h2>Sorteo por Quiniela Nacional</h2>
<div class="controls">
  <input type="text" id="inputNumber" placeholder="N√∫mero (00-99)" maxlength="2">
  <input type="text" id="inputName" placeholder="Nombre">
  <select id="medioPago">
    <option value="Efectivo">Efectivo</option>
    <option value="Mercado Pago">Mercado Pago</option>
    <option value="Banco Patagonia">Banco Patagonia</option>
    <option value="Mercado Pago M√≠o">Mercado Pago M√≠o</option>
    <option value="No Pag√≥">No Pag√≥</option>
  </select>
  <button onclick="assignName()">Asignar</button>
  <button onclick="removeName()">Seleccionar n√∫mero</button>
  <button onclick="modificarMedioPago()">Modificar Medio de Pago</button>
</div>
<div class="controls">
  Valor del N√∫mero: $ <input type="number" id="valorNumero" value="1800">
  <button onclick="actualizarValorNumero()">Actualizar valor</button>
</div>
<div class="exportControls">
  Fecha del Sorteo:
  <input type="text" id="fechaSorteo" placeholder="Ej: 15/06/2025">
  N¬∫ de Sorteo:
  <input type="text" id="numeroSorteo" placeholder="Ej: 123">
  <button onclick="captureGridAsImage()">üì∏ Guardar imagen JPG</button>
</div>
<div class="exportControls">
  Color del marco:
  <input type="color" id="colorMarco" value="#aaaaaa">
  <button onclick="cambiarColorMarco()">Cambiar</button>
  <label class="custom-file-button" onclick="document.getElementById('fondoInput').click()">üì∑ Subir Fondo</label>
  <input type="file" id="fondoInput" accept="image/*" onchange="cambiarFondo()">
</div>
<div class="exportControls">
  <h3>Ingresar N√∫meros Ganadores </h3>
  <div id="ganadoresInputs">
    <input type="text" maxlength="4" placeholder="1¬∫" id="ganador0">
    <input type="text" maxlength="4" placeholder="2¬∫" id="ganador1">
    <input type="text" maxlength="4" placeholder="3¬∫" id="ganador2">
    <input type="text" maxlength="4" placeholder="4¬∫" id="ganador3">
    <input type="text" maxlength="4" placeholder="5¬∫" id="ganador4">
    <input type="text" maxlength="4" placeholder="6¬∫" id="ganador5">
    <input type="text" maxlength="4" placeholder="7¬∫" id="ganador6">
    <input type="text" maxlength="4" placeholder="8¬∫" id="ganador7">
    <input type="text" maxlength="4" placeholder="9¬∫" id="ganador8">
    <input type="text" maxlength="4" placeholder="10¬∫" id="ganador9">
    <button onclick="generarPDFGanadores()"> PDF Ganadores</button>
  </div>
</div>
<div id="captureWrapper">
  <div class="grid" id="grid"></div>
  <div class="premios">
    <div class="premios-title">Premios</div>
    <input type="text" value="1¬∫ Premio">
    <input type="text" value="2¬∫ Premio">
    <input type="text" value="3¬∫ Premio">
    <input type="text" value="4¬∫ Premio">
    <input type="text" value="5¬∫ Premio">
    <input type="text" value="6¬∫ Premio">
    <input type="text" value="7¬∫ Premio">
    <input type="text" value="8¬∫ Premio">
    <input type="text" value="9¬∫ Premio">
    <input type="text" value="10¬∫ Premio">
  </div>
</div>
<script>
const numbers = {};
let valorActual = 0000;
const grid = document.getElementById("grid");
for (let i = 0; i < 100; i++) {
  const num = i.toString().padStart(2, '0');
  numbers[num] = { nombre: '', medio: null };
  const div = document.createElement("div");
  div.className = "number";
  div.id = "num-" + num;
  div.innerText = num;
  grid.appendChild(div);
}
function actualizarValorNumero() {
  const nuevoValor = parseFloat(document.getElementById("valorNumero").value);
  if (isNaN(nuevoValor) || nuevoValor <= 0) return alert("Valor inv√°lido");
  valorActual = nuevoValor;
}
function assignName() {
  const num = document.getElementById("inputNumber").value.padStart(2, '0');
  const name = document.getElementById("inputName").value.trim();
  const medio = document.getElementById("medioPago").value;
  if (!numbers.hasOwnProperty(num)) return alert("N√∫mero inv√°lido");
  if (!name) return alert("Nombre requerido");
  numbers[num].nombre = name;
  numbers[num].medio = medio;
  actualizarVisual(num);
  generatePDFTicket(num);
}
function modificarMedioPago() {
  const num = document.getElementById("inputNumber").value.padStart(2, '0');
  if (!numbers.hasOwnProperty(num)) return alert("N√∫mero inv√°lido");
  const medio = document.getElementById("medioPago").value;
  numbers[num].medio = medio;
  actualizarVisual(num);
}
function actualizarVisual(num) {
  const div = document.getElementById("num-" + num);
  const nombre = numbers[num].nombre;
  const medio = numbers[num].medio;
  div.innerText = `${num}
${nombre}`;
  div.style.backgroundColor = (medio === "No Pag√≥") ? 'green' : getColorPorMedio(medio);
  div.style.color = (div.style.backgroundColor === 'yellow' || div.style.backgroundColor === 'lightgreen') ? '#000' : '#fff';
}
function removeName() {
  const num = document.getElementById("inputNumber").value.padStart(2, '0');
  if (!numbers.hasOwnProperty(num)) return;
  numbers[num] = { nombre: '', medio: null };
  const div = document.getElementById("num-" + num);
  div.innerText = num;
  div.style.backgroundColor = "#f9f9f9";
  div.style.color = "#000";
}
function getColorPorMedio(medio) {
  const m = medio.toLowerCase();
  if (m.includes("efectivo")) return "red";
  if (m.includes("mercado pago") && m.includes("m√≠o")) return "lightgreen";
  if (m.includes("mercado pago")) return "yellow";
  if (m.includes("patagonia")) return "lightblue";
  return "#d3d3d3";
}
async function generatePDFTicket(numero) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const now = new Date().toLocaleString('es-AR');
  const data = numbers[numero];
  const nombre = data?.nombre || '';
  const medio = data?.medio || 'No especificado';
  doc.setFontSize(18);
  doc.text("N√∫mero Asignado", 20, 20);
  doc.setFontSize(12);
  doc.text("Sortea por Quiniela Nacional", 20, 30);
  doc.text(`Valor del N√∫mero: $${valorActual}`, 20, 38);
  doc.text(`N√∫mero: ${numero}`, 20, 50);
  doc.text(`Nombre: ${nombre}`, 20, 58);
  doc.text(`Medio de Pago: ${medio}`, 20, 66);
  doc.text(`Fecha: ${now}`, 20, 76);
  doc.save(`Ticket_${numero}_${nombre}.pdf`);
}
function captureGridAsImage() {
  html2canvas(document.getElementById("captureWrapper")).then(canvas => {
    const link = document.createElement("a");
    link.download = `Sorteo.jpg`;
    link.href = canvas.toDataURL("image/jpeg", 1.0);
    link.click();
  });
}
function cambiarColorMarco() {
  const color = document.getElementById("colorMarco").value;
  document.getElementById("captureWrapper").style.borderColor = color;
}
function cambiarFondo() {
  const input = document.getElementById("fondoInput");
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function (e) {
      document.body.style.backgroundImage = `url(${e.target.result})`;
    };
    reader.readAsDataURL(input.files[0]);
  }
}
  function generarPDFGanadores() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("Ganadores del Sorteo", 20, 20);
  doc.setFontSize(12);
  let y = 30;

  for (let i = 0; i < 10; i++) {
    const completo = document.getElementById("ganador" + i).value.padStart(4, '0'); // n√∫mero de 4 cifras
    const ultimosDos = completo.slice(-2); // toma los √∫ltimos 2 d√≠gitos
    const persona = numbers[ultimosDos]?.nombre;

    const premio = `${i + 1}¬∫ Premio`;
    if (persona) {
      doc.text(`${premio}: ${completo} (Ganador con el ${ultimosDos}) - ${persona}`, 20, y);
    } else {
      doc.text(`${premio}: ${completo} (Ganador con el ${ultimosDos}) - Sin asignaci√≥n`, 20, y);
    }
    y += 10;
  }

  doc.save("Ganadores.pdf");
}
</script>

<div class="exportControls">
  <button onclick="exportarGrillaSinColores()">Exportar grilla sin colores (PDF)</button>
  <button onclick="cerrarAplicacion()">‚ùå Cerrar</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
function exportarGrillaSinColores() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(10);
  let x = 10, y = 20, count = 0;

  for (let i = 0; i < 100; i++) {
    const num = i.toString().padStart(2, '0');
    const nombre = numbers[num].nombre || '';
    doc.text(`${num} ${nombre}`, x, y);
    x += 40;
    count++;
    if (count % 5 === 0) {
      x = 10;
      y += 10;
    }
  }

  doc.save("Grilla_Sin_Colores.pdf");
}

function cerrarAplicacion() {
  if (!confirm("¬øEst√°s seguro de que quer√©s cerrar? Se generar√°n los archivos PDF y Excel autom√°ticamente.")) return;

  generarPDFCompleto();
  generarExcel();

  setTimeout(() => {
    alert("Archivos generados. Pod√©s cerrar la ventana.");
    // window.close(); // No se permite en muchos navegadores por seguridad
  }, 1000);
}

function generarPDFCompleto() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(10);
  let x = 10, y = 20, count = 0;

  for (let i = 0; i < 100; i++) {
    const num = i.toString().padStart(2, '0');
    const data = numbers[num];
    const linea = `${num} - ${data.nombre || ''} (${data.medio || ''})`;
    doc.text(linea, x, y);
    y += 6;
    if (y > 280) {
      doc.addPage();
      y = 20;
    }
  }

  doc.save("Grilla_Completa.pdf");
}

function generarExcel() {
  const wb = XLSX.utils.book_new();
  const datos = [["N√∫mero", "Nombre", "Medio de Pago"]];

  for (let i = 0; i < 100; i++) {
    const num = i.toString().padStart(2, '0');
    const data = numbers[num];
    datos.push([num, data.nombre || '', data.medio || '']);
  }

  const ws = XLSX.utils.aoa_to_sheet(datos);
  XLSX.utils.book_append_sheet(wb, ws, "Grilla");
  XLSX.writeFile(wb, "Grilla_Sorteo.xlsx");
}
</script>

</body>
</html>
